<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>libhl: src/refcnt.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">libhl
   </div>
   <div id="projectbrief">A collection of C libraries : thread-safe hashtables, thread-safe linklists, lock-free queues, flat buffers, ring buffers, refcounting</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('refcnt_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">refcnt.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>lock-free refcount framework  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br/>
</div>
<p><a href="refcnt_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a9a8823bebfb34f3ffb0a1fc046117cc7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#a9a8823bebfb34f3ffb0a1fc046117cc7">REFCNT_ATOMIC_INCREMENT</a>(__i, __cnt)&#160;&#160;&#160;__sync_fetch_and_add(&amp;__i, __cnt);</td></tr>
<tr class="separator:a9a8823bebfb34f3ffb0a1fc046117cc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98ba35d55811db14d8c55462b2b36f59"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#a98ba35d55811db14d8c55462b2b36f59">REFCNT_ATOMIC_DECREMENT</a>(__i, __cnt)&#160;&#160;&#160;__sync_fetch_and_sub(&amp;__i, __cnt);</td></tr>
<tr class="separator:a98ba35d55811db14d8c55462b2b36f59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c28aab3f65d8182aeac327baac1c5d5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#a2c28aab3f65d8182aeac327baac1c5d5">REFCNT_ATOMIC_READ</a>(__p)&#160;&#160;&#160;__sync_fetch_and_add(&amp;__p, 0)</td></tr>
<tr class="separator:a2c28aab3f65d8182aeac327baac1c5d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b92779f25709677a617fa346cf6a338"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#a5b92779f25709677a617fa346cf6a338">REFCNT_ATOMIC_CMPXCHG</a>(__p, __v1, __v2)&#160;&#160;&#160;__sync_bool_compare_and_swap(&amp;__p, __v1, __v2)</td></tr>
<tr class="separator:a5b92779f25709677a617fa346cf6a338"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a512324eabd6ec2ece6f8babb4a5ab6dd"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#a512324eabd6ec2ece6f8babb4a5ab6dd">REFCNT_ATOMIC_CMPXCHG_RETURN</a>(__p, __v1, __v2)&#160;&#160;&#160;__sync_val_compare_and_swap(&amp;__p, __v1, __v2)</td></tr>
<tr class="separator:a512324eabd6ec2ece6f8babb4a5ab6dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a620f37ba80ce92dde459b83df94b3898"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#a620f37ba80ce92dde459b83df94b3898">REFCNT_MARK_ON</a>(__addr)&#160;&#160;&#160;(<a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *)((intptr_t)<a class="el" href="refcnt_8h.html#a2c28aab3f65d8182aeac327baac1c5d5">REFCNT_ATOMIC_READ</a>(__addr) | 1)</td></tr>
<tr class="separator:a620f37ba80ce92dde459b83df94b3898"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a00ef8f9f2ea1aae916b9eeaf4a150c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#a1a00ef8f9f2ea1aae916b9eeaf4a150c">REFCNT_MARK_OFF</a>(__addr)&#160;&#160;&#160;(<a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *)((intptr_t)<a class="el" href="refcnt_8h.html#a2c28aab3f65d8182aeac327baac1c5d5">REFCNT_ATOMIC_READ</a>(__addr) &amp; -2)</td></tr>
<tr class="separator:a1a00ef8f9f2ea1aae916b9eeaf4a150c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d5cbe64d345ee1438f801ef1d159dba"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#a9d5cbe64d345ee1438f801ef1d159dba">REFCNT_IS_MARKED</a>(__addr)&#160;&#160;&#160;(((intptr_t)<a class="el" href="refcnt_8h.html#a2c28aab3f65d8182aeac327baac1c5d5">REFCNT_ATOMIC_READ</a>(__addr) &amp; 1) == 1)</td></tr>
<tr class="separator:a9d5cbe64d345ee1438f801ef1d159dba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7cecad11a429f49e04564abcdeabdc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#ac7cecad11a429f49e04564abcdeabdc5">REFCNT_RETAIN</a>(__refcnt, __node, __type)&#160;&#160;&#160;((__type) *)<a class="el" href="refcnt_8h.html#abe836170e50f0fabd6a12a9c0be2ce90">get_node_ptr</a>(<a class="el" href="refcnt_8h.html#a2405aaba021bbe47fac32685791ebd27">retain_ref</a>((__refcnt), (__node)))</td></tr>
<tr class="separator:ac7cecad11a429f49e04564abcdeabdc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44e4ff10ac0218a4cff08848a7a1ad70"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#a44e4ff10ac0218a4cff08848a7a1ad70">REFCNT_RELEASE</a>(__refcnt, __node, __type)&#160;&#160;&#160;((__type) *)<a class="el" href="refcnt_8h.html#abe836170e50f0fabd6a12a9c0be2ce90">get_node_ptr</a>(<a class="el" href="refcnt_8h.html#af0083f7de2282f12c4ae0f5d2a17ad66">release_ref</a>((__refcnt), (__node)))</td></tr>
<tr class="separator:a44e4ff10ac0218a4cff08848a7a1ad70"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a0a4c54fe6e676efdfdef450a20f9184a"><td class="memItemLeft" align="right" valign="top">typedef struct __refcnt&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a></td></tr>
<tr class="separator:a0a4c54fe6e676efdfdef450a20f9184a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d0f26fb273aeb9dad7434e96b8096b2"><td class="memItemLeft" align="right" valign="top">typedef struct __refcnt_node&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a></td></tr>
<tr class="separator:a1d0f26fb273aeb9dad7434e96b8096b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79067844ad82292462a1c1a92fae641f"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#a79067844ad82292462a1c1a92fae641f">refcnt_terminate_node_callback_t</a> )(<a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *node, int concurrent)</td></tr>
<tr class="memdesc:a79067844ad82292462a1c1a92fae641f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback called when a node is going to be terminated, which means that its refcount reached 0 and nobody is referencing it at the moment.  <a href="#a79067844ad82292462a1c1a92fae641f">More...</a><br/></td></tr>
<tr class="separator:a79067844ad82292462a1c1a92fae641f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7085f33e5814af06d25541fa6399920d"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#a7085f33e5814af06d25541fa6399920d">refcnt_free_node_ptr_callback_t</a> )(void *ptr)</td></tr>
<tr class="memdesc:a7085f33e5814af06d25541fa6399920d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback called when a node is going to be released and the underlying ptr can be released as well.  <a href="#a7085f33e5814af06d25541fa6399920d">More...</a><br/></td></tr>
<tr class="separator:a7085f33e5814af06d25541fa6399920d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1ccf9e3a68f8ce43fa9ec514215a2f47"><td class="memItemLeft" align="right" valign="top"><a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#a1ccf9e3a68f8ce43fa9ec514215a2f47">refcnt_create</a> (uint32_t gc_threshold, <a class="el" href="refcnt_8h.html#a79067844ad82292462a1c1a92fae641f">refcnt_terminate_node_callback_t</a> terminate_node_cb, <a class="el" href="refcnt_8h.html#a7085f33e5814af06d25541fa6399920d">refcnt_free_node_ptr_callback_t</a> free_node_ptr_cb)</td></tr>
<tr class="memdesc:a1ccf9e3a68f8ce43fa9ec514215a2f47"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new refcounted context.  <a href="#a1ccf9e3a68f8ce43fa9ec514215a2f47">More...</a><br/></td></tr>
<tr class="separator:a1ccf9e3a68f8ce43fa9ec514215a2f47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7447f1452af0f46c9fd060ae3252b179"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#a7447f1452af0f46c9fd060ae3252b179">refcnt_destroy</a> (<a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a> *refcnt)</td></tr>
<tr class="memdesc:a7447f1452af0f46c9fd060ae3252b179"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release all resources hold by the refcounted context pointed by refcnt.  <a href="#a7447f1452af0f46c9fd060ae3252b179">More...</a><br/></td></tr>
<tr class="separator:a7447f1452af0f46c9fd060ae3252b179"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaefd29a35d9eddf0e77341d432774f6f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#aaefd29a35d9eddf0e77341d432774f6f">deref_link</a> (<a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a> *refcnt, <a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> **link)</td></tr>
<tr class="memdesc:aaefd29a35d9eddf0e77341d432774f6f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Atomically creates a reference to a refcounted object.  <a href="#aaefd29a35d9eddf0e77341d432774f6f">More...</a><br/></td></tr>
<tr class="separator:aaefd29a35d9eddf0e77341d432774f6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac41b1b58005f46567f12e58b6767447b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#ac41b1b58005f46567f12e58b6767447b">deref_link_d</a> (<a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a> *refcnt, <a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> **link)</td></tr>
<tr class="memdesc:ac41b1b58005f46567f12e58b6767447b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Atomically creates a reference to a refcounted object. If the object was marked for deletion, its deletion will be canceled and its refcount increased anyway.  <a href="#ac41b1b58005f46567f12e58b6767447b">More...</a><br/></td></tr>
<tr class="separator:ac41b1b58005f46567f12e58b6767447b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0083f7de2282f12c4ae0f5d2a17ad66"><td class="memItemLeft" align="right" valign="top"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#af0083f7de2282f12c4ae0f5d2a17ad66">release_ref</a> (<a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a> *refcnt, <a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *ref)</td></tr>
<tr class="memdesc:af0083f7de2282f12c4ae0f5d2a17ad66"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release a reference by decreasing its refcount.  <a href="#af0083f7de2282f12c4ae0f5d2a17ad66">More...</a><br/></td></tr>
<tr class="separator:af0083f7de2282f12c4ae0f5d2a17ad66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac82fbeffa709f60e15c62be64be293bb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#ac82fbeffa709f60e15c62be64be293bb">compare_and_swap_ref</a> (<a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a> *refcnt, <a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> **link, <a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *old, <a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *ref)</td></tr>
<tr class="memdesc:ac82fbeffa709f60e15c62be64be293bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Atomically compare a reference to a refcounted object with an existing pointer and swap it with a new pointer in case it matches.  <a href="#ac82fbeffa709f60e15c62be64be293bb">More...</a><br/></td></tr>
<tr class="separator:ac82fbeffa709f60e15c62be64be293bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a785a60c5adef70733a59541b80665aad"><td class="memItemLeft" align="right" valign="top"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#a785a60c5adef70733a59541b80665aad">new_node</a> (<a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a> *refcnt, void *ptr)</td></tr>
<tr class="memdesc:a785a60c5adef70733a59541b80665aad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new refcounted node which encapsulates a given pointer.  <a href="#a785a60c5adef70733a59541b80665aad">More...</a><br/></td></tr>
<tr class="separator:a785a60c5adef70733a59541b80665aad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe836170e50f0fabd6a12a9c0be2ce90"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#abe836170e50f0fabd6a12a9c0be2ce90">get_node_ptr</a> (<a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *node)</td></tr>
<tr class="memdesc:abe836170e50f0fabd6a12a9c0be2ce90"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the pointer stored in the refcounted object.  <a href="#abe836170e50f0fabd6a12a9c0be2ce90">More...</a><br/></td></tr>
<tr class="separator:abe836170e50f0fabd6a12a9c0be2ce90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2405aaba021bbe47fac32685791ebd27"><td class="memItemLeft" align="right" valign="top"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#a2405aaba021bbe47fac32685791ebd27">retain_ref</a> (<a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a> *refcnt, <a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *ref)</td></tr>
<tr class="memdesc:a2405aaba021bbe47fac32685791ebd27"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retain a refcounted object by increasing its refcount.  <a href="#a2405aaba021bbe47fac32685791ebd27">More...</a><br/></td></tr>
<tr class="separator:a2405aaba021bbe47fac32685791ebd27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9124ddd2848c9c2da1ae0c4b72f36c2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcnt_8h.html#af9124ddd2848c9c2da1ae0c4b72f36c2">store_ref</a> (<a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a> *refcnt, <a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> **link, <a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *ref)</td></tr>
<tr class="memdesc:af9124ddd2848c9c2da1ae0c4b72f36c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Atomically store a reference to a refcounted object in the memory pointed by the provided address, releasing a previous reference if any.  <a href="#af9124ddd2848c9c2da1ae0c4b72f36c2">More...</a><br/></td></tr>
<tr class="separator:af9124ddd2848c9c2da1ae0c4b72f36c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>lock-free refcount framework </p>
<p>Allows to manage refcounting on pointers accessed by multiple threads. Facilities to atomically reference/dereference pointers are available and are implemented using only the atomic builtins and without any mutex or lock </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a9a8823bebfb34f3ffb0a1fc046117cc7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define REFCNT_ATOMIC_INCREMENT</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__i, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__cnt&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;__sync_fetch_and_add(&amp;__i, __cnt);</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a98ba35d55811db14d8c55462b2b36f59"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define REFCNT_ATOMIC_DECREMENT</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__i, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__cnt&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;__sync_fetch_and_sub(&amp;__i, __cnt);</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a2c28aab3f65d8182aeac327baac1c5d5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define REFCNT_ATOMIC_READ</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__p</td><td>)</td>
          <td>&#160;&#160;&#160;__sync_fetch_and_add(&amp;__p, 0)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a5b92779f25709677a617fa346cf6a338"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define REFCNT_ATOMIC_CMPXCHG</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__p, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__v1, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__v2&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;__sync_bool_compare_and_swap(&amp;__p, __v1, __v2)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a512324eabd6ec2ece6f8babb4a5ab6dd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define REFCNT_ATOMIC_CMPXCHG_RETURN</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__p, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__v1, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__v2&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;__sync_val_compare_and_swap(&amp;__p, __v1, __v2)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a620f37ba80ce92dde459b83df94b3898"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define REFCNT_MARK_ON</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__addr</td><td>)</td>
          <td>&#160;&#160;&#160;(<a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *)((intptr_t)<a class="el" href="refcnt_8h.html#a2c28aab3f65d8182aeac327baac1c5d5">REFCNT_ATOMIC_READ</a>(__addr) | 1)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a1a00ef8f9f2ea1aae916b9eeaf4a150c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define REFCNT_MARK_OFF</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__addr</td><td>)</td>
          <td>&#160;&#160;&#160;(<a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *)((intptr_t)<a class="el" href="refcnt_8h.html#a2c28aab3f65d8182aeac327baac1c5d5">REFCNT_ATOMIC_READ</a>(__addr) &amp; -2)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a9d5cbe64d345ee1438f801ef1d159dba"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define REFCNT_IS_MARKED</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__addr</td><td>)</td>
          <td>&#160;&#160;&#160;(((intptr_t)<a class="el" href="refcnt_8h.html#a2c28aab3f65d8182aeac327baac1c5d5">REFCNT_ATOMIC_READ</a>(__addr) &amp; 1) == 1)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ac7cecad11a429f49e04564abcdeabdc5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define REFCNT_RETAIN</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__refcnt, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__node, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__type&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;((__type) *)<a class="el" href="refcnt_8h.html#abe836170e50f0fabd6a12a9c0be2ce90">get_node_ptr</a>(<a class="el" href="refcnt_8h.html#a2405aaba021bbe47fac32685791ebd27">retain_ref</a>((__refcnt), (__node)))</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a44e4ff10ac0218a4cff08848a7a1ad70"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define REFCNT_RELEASE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__refcnt, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__node, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">__type&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;((__type) *)<a class="el" href="refcnt_8h.html#abe836170e50f0fabd6a12a9c0be2ce90">get_node_ptr</a>(<a class="el" href="refcnt_8h.html#af0083f7de2282f12c4ae0f5d2a17ad66">release_ref</a>((__refcnt), (__node)))</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="a0a4c54fe6e676efdfdef450a20f9184a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct __refcnt <a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a1d0f26fb273aeb9dad7434e96b8096b2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct __refcnt_node <a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a79067844ad82292462a1c1a92fae641f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* refcnt_terminate_node_callback_t)(<a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *node, int concurrent)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback called when a node is going to be terminated, which means that its refcount reached 0 and nobody is referencing it at the moment. </p>
<dl class="section note"><dt>Note</dt><dd>The terminate_node callback makes sure that none of the node’s contained links have any claim on any other node. The callback is called on a deleted node when there are no claims from any other node or thread to the node. When the argument concurrent is false, refcnt guarantees that there wannot be any concurrent updates of the node, thereby allowing the terminate_node callaback to use the cheaper StoreRef instead of CompareAndSwapRef to update the node’s links. </dd></dl>

</div>
</div>
<a class="anchor" id="a7085f33e5814af06d25541fa6399920d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* refcnt_free_node_ptr_callback_t)(void *ptr)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback called when a node is going to be released and the underlying ptr can be released as well. </p>
<dl class="section note"><dt>Note</dt><dd>If this callback is being called, there is no possibility for the node to be referenced anymore so it's now safe to release the underlying pointer. </dd></dl>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a1ccf9e3a68f8ce43fa9ec514215a2f47"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a>* refcnt_create </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>gc_threshold</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a79067844ad82292462a1c1a92fae641f">refcnt_terminate_node_callback_t</a>&#160;</td>
          <td class="paramname"><em>terminate_node_cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a7085f33e5814af06d25541fa6399920d">refcnt_free_node_ptr_callback_t</a>&#160;</td>
          <td class="paramname"><em>free_node_ptr_cb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a new refcounted context. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">gc_threshold</td><td>: The garbage-collector threshold, basically how many unreferenced pointers can be accumulated before the garbage collector triggers and starts releasing the older ones </td></tr>
    <tr><td class="paramname">terminate_node_cb</td><td>: The terminate node callback </td></tr>
    <tr><td class="paramname">free_node_ptr_cb</td><td>: The free node callback </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a7447f1452af0f46c9fd060ae3252b179"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void refcnt_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a> *&#160;</td>
          <td class="paramname"><em>refcnt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Release all resources hold by the refcounted context pointed by refcnt. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">refcnt</td><td>: A pointer to a valid refcounted context </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="aaefd29a35d9eddf0e77341d432774f6f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a>* deref_link </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a> *&#160;</td>
          <td class="paramname"><em>refcnt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> **&#160;</td>
          <td class="paramname"><em>link</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Atomically creates a reference to a refcounted object. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">refcnt</td><td>: A pointer to a valid refcounted context </td></tr>
    <tr><td class="paramname">link</td><td>: The address where the pointer to the node to be referenced is stored </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>: A pointer to the node which has been referenced. Its refcount has been increased by 1 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>: Objects marked for deletion (whose refcount is 0) are ignored and their refcount untouched </dd></dl>

</div>
</div>
<a class="anchor" id="ac41b1b58005f46567f12e58b6767447b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a>* deref_link_d </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a> *&#160;</td>
          <td class="paramname"><em>refcnt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> **&#160;</td>
          <td class="paramname"><em>link</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Atomically creates a reference to a refcounted object. If the object was marked for deletion, its deletion will be canceled and its refcount increased anyway. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">refcnt</td><td>: A pointer to a valid refcounted context </td></tr>
    <tr><td class="paramname">link</td><td>: The address where the pointer to the node to be referenced is stored </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>: A pointer to the node which has been referenced. Its refcount has been increased by 1 </dd></dl>

</div>
</div>
<a class="anchor" id="af0083f7de2282f12c4ae0f5d2a17ad66"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a>* release_ref </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a> *&#160;</td>
          <td class="paramname"><em>refcnt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *&#160;</td>
          <td class="paramname"><em>ref</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Release a reference by decreasing its refcount. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">refcnt</td><td>: A pointer to a valid refcounted context </td></tr>
    <tr><td class="paramname">ref</td><td>: The reference to release </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>: The refcount of the provided reference is decreased by 1 </dd></dl>

</div>
</div>
<a class="anchor" id="ac82fbeffa709f60e15c62be64be293bb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int compare_and_swap_ref </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a> *&#160;</td>
          <td class="paramname"><em>refcnt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> **&#160;</td>
          <td class="paramname"><em>link</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *&#160;</td>
          <td class="paramname"><em>old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *&#160;</td>
          <td class="paramname"><em>ref</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Atomically compare a reference to a refcounted object with an existing pointer and swap it with a new pointer in case it matches. </p>

</div>
</div>
<a class="anchor" id="a785a60c5adef70733a59541b80665aad"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a>* new_node </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a> *&#160;</td>
          <td class="paramname"><em>refcnt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a new refcounted node which encapsulates a given pointer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">refcnt</td><td>: A pointer to a valid refcounted context </td></tr>
    <tr><td class="paramname">ptr</td><td>: The pointer to encapsulate in the refcounted object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>: An initialized refcounted object holding the given 'ptr' </dd></dl>

</div>
</div>
<a class="anchor" id="abe836170e50f0fabd6a12a9c0be2ce90"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* get_node_ptr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *&#160;</td>
          <td class="paramname"><em>node</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve the pointer stored in the refcounted object. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>: A pointer to a valid refcounted object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>: The pointer stored in the refcounted object </dd></dl>

</div>
</div>
<a class="anchor" id="a2405aaba021bbe47fac32685791ebd27"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a>* retain_ref </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a> *&#160;</td>
          <td class="paramname"><em>refcnt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *&#160;</td>
          <td class="paramname"><em>ref</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retain a refcounted object by increasing its refcount. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">refcnt</td><td>: A pointer to a valid refcounted context </td></tr>
    <tr><td class="paramname">ref</td><td>: The reference to retain </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>: The refcount of the provided reference is increased by 1 </dd></dl>

</div>
</div>
<a class="anchor" id="af9124ddd2848c9c2da1ae0c4b72f36c2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void store_ref </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a0a4c54fe6e676efdfdef450a20f9184a">refcnt_t</a> *&#160;</td>
          <td class="paramname"><em>refcnt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> **&#160;</td>
          <td class="paramname"><em>link</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="refcnt_8h.html#a1d0f26fb273aeb9dad7434e96b8096b2">refcnt_node_t</a> *&#160;</td>
          <td class="paramname"><em>ref</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Atomically store a reference to a refcounted object in the memory pointed by the provided address, releasing a previous reference if any. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">refcnt</td><td>: A pointer to a valid refcounted context </td></tr>
    <tr><td class="paramname">link</td><td>: The address where to store the pointer to the reference </td></tr>
    <tr><td class="paramname">ref</td><td>: The reference to store into *link </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>: The refcount of the provided reference is increased by 1 : If link points to an existing reference, its refcount will be decreased by 1 before storing the new reference </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="refcnt_8h.html">refcnt.h</a></li>
    <li class="footer">Generated on Thu Apr 17 2014 15:53:54 for libhl by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
